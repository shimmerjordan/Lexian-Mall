<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="lexian.mapper.CommodityMapper">

	<resultMap id="commodity_map" type="Commodity">
		<id property="ID" column="Commodity.ID" />
		<result property="modify_time" column="Commodity.modify_time" />
		<result property="introduction" column="Commodity.introduction" />
		<result property="name" column="Commodity.`name`" />
		<result property="image" column="Commodity.`image`" />
		<result property="price" column="Commodity.`price`" />
		<result property="storage" column="Commodity.`storage`" />
		<result property="specification" column="Commodity.`specification`" />
		<result property="status" column="Commodity.`status`" />
		<result property="is_delete" column="Commodity.`is_delete`" />
	</resultMap>
	<select id="getAllShopCommodity" resultType="Commodity">
		SELECT
		Commodity.ID,
		Commodity.modify_time,
		Commodity.introduction,
		Commodity.`name`,
		Commodity.`image`,
		Commodity.`price`,
		Commodity.`storage`,
		Commodity.`specification`,
		Commodity.`status`,
		Commodity.`is_delete`
		FROM
		commodity
		INNER JOIN shop_commodity ON commodity.ID =
		shop_commodity.commodity_id
		INNER JOIN shop ON shop.ID =
		shop_commodity.shop_id
		WHERE
		commodity.is_delete=0
	</select>

	<update id="updateGood" parameterType="java.util.HashMap">
		UPDATE commodity
		SET
		commodity.name=#{name},
		commodity.modify_time=NOW(),
		commodity.storage=#{storage},
		commodity.price=#{price},
		commodity.introduction=#{introduction}
		WHERE
		commodity.ID=#{id}
	</update>

	<select id="selectCommodityByCategoryId" resultType="lexian.entity.Commodity"
		parameterType="lexian.entity.Commodity">
		SELECT
		g.ID,
		g.modify_time,
		g.introduction,
		g.NAME,
		g.image,
		g.price,
		g.STORAGE,
		g.specification,
		g.STATUS,
		g.is_delete,
		oi.sales
		FROM
		commodity g
		JOIN category_commodity gc ON g.ID = gc.commodity_id
		LEFT JOIN ( SELECT sum( commodity_quantity ) AS sales, commodity_id FROM
		order_item GROUP BY commodity_id ) oi ON g.id = oi.commodity_id
		where gc.category_id = #{categoryId}
		<if test="sortType != null and sortType !=''">
		   <if test="sortType == 1">
		      order by oi.sales desc
		   </if>
		   <if test="sortType == 2">
		      order by g.price 
		   </if>
		   <if test="sortType == 3">
		      order by g.price desc
		   </if>		   		   
		
		</if>
	</select>

	<update id="deleteGood">
		UPDATE shop_commodity
		SET shop_commodity.isDelete=1
		WHERE shop_commodity.commodity_id=#{id}
	</update>
</mapper>